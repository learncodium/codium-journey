<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Codium — Auth</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="icon" type="ico" href="logo.ico">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#1a1a1a; --bg2:#0b0b0b;
    --accent1:#00ffa6; --accent2:#00c8ff; --accent3:#ff00c8;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(circle at top, var(--bg1), var(--bg2));
    color:#fff;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }

  .auth-shell {
    width:100%;
    max-width:980px;
    height:640px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;
    overflow:hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 10px 40px rgba(0,200,255,0.04);
    position:relative;
  }

  .auth-header{
    padding:28px 36px;
    text-align:center;
  }
  .auth-title{
    font-size:2rem;
    margin:0;
    background: linear-gradient(90deg, var(--accent1), var(--accent2), var(--accent3));
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    animation: gradMove 4s linear infinite;
  }
  @keyframes gradMove{from{background-position:0%}to{background-position:100%}}

  .slider {
    width:300%;
    height: calc(100% - 96px);
    display:flex;
    transition: transform 420ms cubic-bezier(.2,.9,.28,1);
  }
  .panel {
    width: calc(100% / 3);
    padding: 28px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
  }

  .card {
    width:100%;
    max-width:420px;
    background: rgba(255,255,255,0.03);
    border-radius:12px;
    padding:28px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    text-align:center;
  }

  .btn {
    display:inline-block;
    padding:12px 28px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    font-weight:600;
    background:linear-gradient(90deg,var(--accent2),var(--accent1));
    color:#001;
    box-shadow: 0 8px 30px rgba(0,200,255,0.12);
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{
    background:transparent;
    color:var(--accent2);
    border:1px solid rgba(0,200,255,0.12);
    box-shadow:none;
  }

  .choice-row { display:flex; gap:18px; justify-content:center; margin-top:18px; flex-wrap:wrap; }
  .choice-btn {
    width:220px;
    padding:14px 18px;
    border-radius:12px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    color:#fff;
    cursor:pointer;
    text-align:center;
    font-weight:700;
    box-shadow: 0 12px 40px rgba(0,0,0,0.45);
  }
  .choice-btn.blue {
    background: linear-gradient(90deg,#2979ff,#00a3ff);
    color:#fff;
    box-shadow: 0 12px 40px rgba(0,120,255,0.16);
  }

  label{display:block; text-align:left; font-size:0.9rem; margin:12px 0 6px; color: #cfefff}
  input[type="email"], input[type="password"], input[type="text"]{
    width:100%;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(0,0,0,0.35);
    color:#fff;
    outline:none;
  }
  .form-row{ margin-top:12px }

  .small {
    margin-top:10px;
    font-size:0.9rem;
    color:#cfefff;
    opacity:0.85;
  }

  .back-link{
    margin-top:10px;
    color: #a7e8ff;
    cursor:pointer;
    text-decoration:underline;
    font-weight:600;
  }

  .notice { margin-top:14px; color:#ffd1d1; font-weight:600; }

  .oauth-btn {
    display:flex;
    align-items:center;
    gap:10px;
    justify-content:center;
    padding:10px 14px;
    border-radius:10px;
    width:100%;
    max-width:360px;
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02);
    cursor:pointer;
    margin-top:12px;
    font-weight:700;
  }
  .oauth-google { background: linear-gradient(90deg,#f6f9fb,#fff); color:#111; }

  .form-actions { display:flex; gap:12px; justify-content:center; margin-top:18px; }

  @media (max-width:880px){
    .auth-shell { max-width:760px; height:720px; }
    .choice-btn { width:180px; }
  }
  @media (max-width:520px){
    .auth-shell { padding:0; height:auto; max-width:420px; }
    .slider{ flex-direction:column; width:100%; transition:transform 420ms cubic-bezier(.2,.9,.28,1); }
    .panel{ width:100%; min-height:520px; padding:20px; }
  }

  /* LOADING overlay: transparent background (no heavy dim), spinner only */
  #loading-overlay {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    pointer-events: none; /* initially non-blocking */
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:2000;
  }
  #loading-overlay.active { pointer-events: all; } /* blocks clicks when active */

  .spinner {
    width:86px; height:86px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 8px 30px rgba(0,200,255,0.12), 0 0 40px rgba(0,200,255,0.06);
    backdrop-filter: blur(0px);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }

  .spinner:after{
    content:"";
    width:46px; height:46px; border-radius:50%;
    border:4px solid rgba(255,255,255,0.12);
    border-top-color: var(--accent2);
    animation: spin 900ms linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* small message under spinner */
  #loading-msg { margin-top:12px; color:#cfefff; font-weight:600; text-align:center; margin-left:12px; }

</style>
</head>
<body>
<div class="auth-shell" role="main" aria-label="Authentication">
  <div class="auth-header">
    <h1 class="auth-title">Welcome to Codium</h1>
    <div class="small">Pick an option to get started</div>
  </div>

  <div id="slider" class="slider" style="transform:translateX(0%)">
    <!-- Panel 1: Choice -->
    <section class="panel" aria-hidden="false">
      <div class="card" role="region" aria-label="Choose action">
        <h2 style="margin:0 0 8px">Get started</h2>
        <p class="small">Create a new account or sign in to continue</p>

        <div class="choice-row" style="margin-top:18px">
          <button id="btn-create" class="choice-btn blue">Create an account</button>
          <button id="btn-signin" class="choice-btn">Sign in</button>
        </div>

        <p class="small" style="margin-top:20px">We removed "Continue with Apple" — use email or Google to sign up / sign in.</p>
      </div>
    </section>

    <!-- Panel 2: Create account -->
    <section class="panel" aria-hidden="true">
      <div class="card" role="region" aria-label="Create account form">
        <h2 style="margin:0 0 6px">Create an account</h2>
        <p class="small">Use your email or Google</p>

        <div class="form-row">
          <label for="signup-email">Email</label>
          <input id="signup-email" type="email" inputmode="email" autocomplete="email" />
        </div>
        <div class="form-row">
          <label for="signup-password">Password</label>
          <input id="signup-password" type="password" autocomplete="new-password" />
        </div>

        <div class="form-actions">
          <button id="signup-btn" class="btn">Create account</button>
        </div>

        <div style="margin-top:8px">
          <button id="signup-google" class="oauth-btn oauth-google" aria-label="Sign up with Google">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="vertical-align:middle"><path d="M21.35 11.1h-9.18v2.92h5.26c-.23 1.26-1.13 2.33-2.42 2.88v2.39h3.9c2.3-2.12 3.6-5.25 3.6-8.87 0-.6-.05-1.18-.11-1.52z" fill="#4285F4"/><path d="M12.17 22c2.94 0 5.41-.98 7.21-2.66l-3.9-2.39c-1.09.74-2.48 1.18-3.3 1.18-2.53 0-4.68-1.7-5.44-3.98H2.72v2.5C4.54 19.8 8.07 22 12.17 22z" fill="#34A853"/><path d="M6.72 13.15a6.6 6.6 0 010-4.3V6.36H2.72a10.02 10.02 0 000 11.28l4-2.49z" fill="#FBBC05"/><path d="M12.17 6.5c1.6 0 3.05.55 4.19 1.62l3.14-3.06C17.57 2.97 15.1 2 12.17 2 8.07 2 4.54 4.2 2.72 6.36l4 2.49c.76-2.28 2.91-3.98 5.45-3.98z" fill="#EA4335"/></svg>
            <span style="vertical-align:middle">Continue with Google</span>
          </button>
        </div>

        <div id="signup-msg" class="notice" aria-live="polite" style="display:none"></div>

        <div class="back-link" data-target="0">← Back</div>
      </div>
    </section>

    <!-- Panel 3: Sign in -->
    <section class="panel" aria-hidden="true">
      <div class="card" role="region" aria-label="Sign in form">
        <h2 style="margin:0 0 6px">Welcome back</h2>
        <p class="small">Sign in with your email or Google</p>

        <div class="form-row">
          <label for="signin-email">Email</label>
          <input id="signin-email" type="email" inputmode="email" autocomplete="email" />
        </div>
        <div class="form-row">
          <label for="signin-password">Password</label>
          <input id="signin-password" type="password" autocomplete="current-password" />
        </div>

        <div class="form-actions">
          <button id="signin-btn" class="btn">Sign in</button>
        </div>

        <div style="margin-top:8px">
          <button id="signin-google" class="oauth-btn oauth-google" aria-label="Sign in with Google">
            <!-- same Google icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="vertical-align:middle"><path d="M21.35 11.1h-9.18v2.92h5.26c-.23 1.26-1.13 2.33-2.42 2.88v2.39h3.9c2.3-2.12 3.6-5.25 3.6-8.87 0-.6-.05-1.18-.11-1.52z" fill="#4285F4"/><path d="M12.17 22c2.94 0 5.41-.98 7.21-2.66l-3.9-2.39c-1.09.74-2.48 1.18-3.3 1.18-2.53 0-4.68-1.7-5.44-3.98H2.72v2.5C4.54 19.8 8.07 22 12.17 22z" fill="#34A853"/><path d="M6.72 13.15a6.6 6.6 0 010-4.3V6.36H2.72a10.02 10.02 0 000 11.28l4-2.49z" fill="#FBBC05"/><path d="M12.17 6.5c1.6 0 3.05.55 4.19 1.62l3.14-3.06C17.57 2.97 15.1 2 12.17 2 8.07 2 4.54 4.2 2.72 6.36l4 2.49c.76-2.28 2.91-3.98 5.45-3.98z" fill="#EA4335"/></svg>
            <span style="vertical-align:middle">Continue with Google</span>
          </button>
        </div>

        <div id="signin-msg" class="notice" aria-live="polite" style="display:none"></div>

        <div class="back-link" data-target="0">← Back</div>
      </div>
    </section>
  </div>
</div>

<!-- Transparent loading overlay with spinner only (blocks input while active) -->
<div id="loading-overlay" aria-hidden="true">
  <div style="display:flex; flex-direction:column; align-items:center; gap:6px;">
    <div class="spinner" role="status" aria-label="Loading"></div>
    <div id="loading-msg" style="color:#cfefff; font-weight:600; display:none">Processing…</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // === CONFIG: replace with your Supabase keys ===
  const SUPABASE_URL = "https://esdzwumkkdnlxsiljlzp.supabase.co";
  const SUPABASE_ANON_KEY =   "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzZHp3dW1ra2RubHhzaWxqbHpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2NDkxMzAsImV4cCI6MjA3NjIyNTEzMH0.ZTcGGjJGqZhWam-iwewA5Dc6q13BgkCIY4a2_TYBhu0";
  // ====================================================
  const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // UI refs
  const slider = document.getElementById('slider');
  const btnCreate = document.getElementById('btn-create');
  const btnSignin = document.getElementById('btn-signin');
  const backLinks = document.querySelectorAll('.back-link');

  const signupEmail = document.getElementById('signup-email');
  const signupPass = document.getElementById('signup-password');
  const signupBtn = document.getElementById('signup-btn');
  const signupMsg = document.getElementById('signup-msg');

  const signinEmail = document.getElementById('signin-email');
  const signinPass = document.getElementById('signin-password');
  const signinBtn = document.getElementById('signin-btn');
  const signinMsg = document.getElementById('signin-msg');

  const signupGoogle = document.getElementById('signup-google');
  const signinGoogle = document.getElementById('signin-google');

  const loadingOverlay = document.getElementById('loading-overlay');
  const loadingMsg = document.getElementById('loading-msg');

  function showLoading(msg = 'Processing…') {
    loadingOverlay.classList.add('active');
    loadingOverlay.setAttribute('aria-hidden', 'false');
    loadingMsg.textContent = msg;
    loadingMsg.style.display = 'block';
  }
  function hideLoading() {
    loadingOverlay.classList.remove('active');
    loadingOverlay.setAttribute('aria-hidden', 'true');
    loadingMsg.style.display = 'none';
  }

  function goToPanel(index) {
    const percent = - (index * (100 / 3));
    slider.style.transform = `translateX(${percent}%)`;
    const panels = slider.querySelectorAll('.panel');
    panels.forEach((p, i) => p.setAttribute('aria-hidden', i !== index));
  }

  btnCreate.addEventListener('click', () => goToPanel(1));
  btnSignin.addEventListener('click', () => goToPanel(2));
  backLinks.forEach(b => b.addEventListener('click', () => goToPanel(Number(b.dataset.target))));

  // If user already signed in -> redirect to dashboard
  (async () => {
    try {
      const { data: { session } } = await client.auth.getSession();
      if (session && session.user) {
        window.location.href = 'dashboard.html';
        return;
      }
    } catch (e) {
      console.warn('session check failed', e);
    }
  })();

  // ---------------- SIGN UP ----------------
  signupBtn.addEventListener('click', async () => {
    signupMsg.style.display = 'none';
    const email = signupEmail.value.trim();
    const password = signupPass.value;
    if (!email || !password) {
      showMsg(signupMsg, 'Please enter email and password');
      return;
    }

    try {
      showLoading('Creating account…');
      signupBtn.disabled = true;
      signupBtn.textContent = 'Creating...';

      const { data, error } = await client.auth.signUp(
        { email, password },
        { redirectTo: window.location.origin + 'https://learncodium.github.io/codium-journey/dashboard.html' }
      );

      if (error) {
        showMsg(signupMsg, error.message || 'Sign up failed');
      } else {
        // If signed in immediately, redirect
        if (data.user) {
          window.location.href = 'dashboard.html';
        } else {
          // Often requires email confirmation — notify user
          showMsg(signupMsg, 'Check your email to confirm sign up (if required).');
        }
      }
    } catch (err) {
      console.error(err);
      showMsg(signupMsg, 'Unexpected error. Try again.');
    } finally {
      hideLoading();
      signupBtn.disabled = false;
      signupBtn.textContent = 'Create account';
    }
  });

  // ---------------- SIGN IN ----------------
  signinBtn.addEventListener('click', async () => {
    signinMsg.style.display = 'none';
    const email = signinEmail.value.trim();
    const password = signinPass.value;
    if (!email || !password) {
      showMsg(signinMsg, 'Please enter email and password');
      return;
    }

    try {
      showLoading('Signing in…');
      signinBtn.disabled = true;
      signinBtn.textContent = 'Signing in...';

      const { data, error } = await client.auth.signInWithPassword({ email, password });
      if (error) {
        showMsg(signinMsg, error.message || 'Sign in failed');
      } else if (data.session) {
        // success -> redirect
        window.location.href = 'https://learncodium.github.io/codium-journey/dashboard.html';
      } else {
        showMsg(signinMsg, 'Sign in did not return a session.');
      }
    } catch (err) {
      console.error(err);
      showMsg(signinMsg, 'Unexpected error. Try again.');
    } finally {
      hideLoading();
      signinBtn.disabled = false;
      signinBtn.textContent = 'Sign in';
    }
  });

  // ---------------- GOOGLE OAUTH ----------------
  // Both buttons call same provider flow, with redirect to dashboard
  async function signInWithGoogle() {
    try {
      showLoading('Redirecting to Google…');
      // triggers redirect to Google; user will return to redirectTo when done
      await client.auth.signInWithOAuth({
        provider: 'google',
        options: { redirectTo: window.location.origin + '/dashboard.html' }
      });
      // note: after redirect, Supabase handles return; this page will be unloaded
    } catch (err) {
      console.error(err);
      hideLoading();
      alert('Google sign-in failed. Try again.');
    }
  }
  signupGoogle.addEventListener('click', signInWithGoogle);
  signinGoogle.addEventListener('click', signInWithGoogle);

  // Helper for messages
  function showMsg(el, text){
    el.style.display = 'block';
    el.textContent = text;
  }

  // Accessibility: Enter submits
  [signupEmail, signupPass].forEach(inp => inp.addEventListener('keydown', e => { if (e.key === 'Enter') signupBtn.click(); }));
  [signinEmail, signinPass].forEach(inp => inp.addEventListener('keydown', e => { if (e.key === 'Enter') signinBtn.click(); }));
</script>
</body>
</html>
